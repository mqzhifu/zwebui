/*! 
 Build based on gin-vue-admin 
 Time : 1654852887000 */
var e=Object.defineProperty,a=Object.getOwnPropertySymbols,t=Object.prototype.hasOwnProperty,l=Object.prototype.propertyIsEnumerable,u=(a,t,l)=>t in a?e(a,t,{enumerable:!0,configurable:!0,writable:!0,value:l}):a[t]=l,o=(e,a,t)=>new Promise(((l,u)=>{var o=e=>{try{i(t.next(e))}catch(a){u(a)}},r=e=>{try{i(t.throw(e))}catch(a){u(a)}},i=e=>e.done?l(e.value):Promise.resolve(e.value).then(o,r);i((t=t.apply(e,a)).next())}));import{g as r,d as i,c as d,u as n,a as s}from"./gin-vue-admin-authority.16548528870002.js";import y from"./gin-vue-admin-menus.1654852887000.js";import h from"./gin-vue-admin-apis.1654852887000.js";import v from"./gin-vue-admin-datas.1654852887000.js";import{W as m}from"./gin-vue-admin-warningBar.1654852887000.js";import{r as c,b as p,o as f,c as g,e as I,d as b,w,q as _,f as k,h as C,V as N,i as V}from"../gva/gin-vue-admin-index.1654852887000.js";import"./gin-vue-admin-authorityBtn.1654852887000.js";import"./gin-vue-admin-api.16548528870002.js";const x={class:"authority"},j={class:"gva-table-box"},z={class:"gva-btn-list"},O=C("新增角色"),A=C("设置权限"),P=C("新增子角色"),S=C("拷贝"),U=C("编辑"),q=C("删除"),B={class:"dialog-footer"},D=C("取 消"),E=C("确 定"),R={name:"Authority"},F=Object.assign(R,{setup(e){const C=c([{authorityId:"0",authorityName:"根角色"}]),R=c(!1),F=c("add"),T=c({}),W=c("新增角色"),$=c(!1),G=c(!1),H=c({}),J=c({authorityId:"",authorityName:"",parentId:"0"}),K=c({authorityId:[{required:!0,message:"请输入角色ID",trigger:"blur"},{validator:(e,a,t)=>/^[0-9]*[1-9][0-9]*$/.test(a)?t():t(new Error("请输入正整数")),trigger:"blur"}],authorityName:[{required:!0,message:"请输入角色名",trigger:"blur"}],parentId:[{required:!0,message:"请选择请求方式",trigger:"blur"}]}),L=c(1),M=c(0),Q=c(999),X=c([]),Y=c({}),Z=()=>o(this,null,(function*(){const e=yield r(((e,o)=>{for(var r in o||(o={}))t.call(o,r)&&u(e,r,o[r]);if(a)for(var r of a(o))l.call(o,r)&&u(e,r,o[r]);return e})({page:L.value,pageSize:Q.value},Y.value));0===e.code&&(X.value=e.data.list,M.value=e.data.total,L.value=e.data.page,Q.value=e.data.pageSize)}));Z();const ee=(e,a)=>{T.value[e]=a},ae=c(null),te=c(null),le=c(null),ue=(e,a)=>{const t=[ae,te,le];a&&t[a].value.needConfirm&&(t[a].value.enterAndNext(),t[a].value.needConfirm=!1)},oe=e=>{N.confirm("此操作将永久删除该角色, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>o(this,null,(function*(){0===(yield i({authorityId:e.authorityId})).code&&(V({type:"success",message:"删除成功!"}),1===X.value.length&&L.value>1&&L.value--,Z())})))).catch((()=>{V({type:"info",message:"已取消删除"})}))},re=c(null),ie=()=>{re.value&&re.value.resetFields(),J.value={authorityId:"",authorityName:"",parentId:"0"}},de=()=>{ie(),$.value=!1,G.value=!1},ne=()=>{if("0"===J.value.authorityId)return V({type:"error",message:"角色id不能为0"}),!1;re.value.validate((e=>o(this,null,(function*(){if(e){switch(F.value){case"add":0===(yield s(J.value)).code&&(V({type:"success",message:"添加成功!"}),Z(),de());break;case"edit":0===(yield n(J.value)).code&&(V({type:"success",message:"添加成功!"}),Z(),de());break;case"copy":{const e={authority:{authorityId:"string",authorityName:"string",datauthorityId:[],parentId:"string"},oldAuthorityId:0};e.authority.authorityId=J.value.authorityId,e.authority.authorityName=J.value.authorityName,e.authority.parentId=J.value.parentId,e.authority.dataAuthorityId=H.value.dataAuthorityId,e.oldAuthorityId=H.value.authorityId;0===(yield d(e)).code&&(V({type:"success",message:"复制成功！"}),Z())}}ie(),$.value=!1}}))))},se=()=>{C.value=[{authorityId:"0",authorityName:"根角色"}],ye(X.value,C.value,!1)},ye=(e,a,t)=>{J.value.authorityId=String(J.value.authorityId),e&&e.forEach((e=>{if(e.children&&e.children.length){const l={authorityId:e.authorityId,authorityName:e.authorityName,disabled:t||e.authorityId===J.value.authorityId,children:[]};ye(e.children,l.children,t||e.authorityId===J.value.authorityId),a.push(l)}else{const l={authorityId:e.authorityId,authorityName:e.authorityName,disabled:t||e.authorityId===J.value.authorityId};a.push(l)}}))},he=e=>{ie(),W.value="新增角色",F.value="add",J.value.parentId=e,se(),$.value=!0};return(e,a)=>{const t=p("el-button"),l=p("el-table-column"),u=p("el-table"),o=p("el-cascader"),r=p("el-form-item"),i=p("el-input"),d=p("el-form"),n=p("el-dialog"),s=p("el-tab-pane"),c=p("el-tabs"),N=p("el-drawer");return f(),g("div",x,[I(m,{title:"注：右上角头像下拉可切换角色"}),b("div",j,[b("div",z,[I(t,{size:"small",type:"primary",icon:"plus",onClick:a[0]||(a[0]=e=>he("0"))},{default:w((()=>[O])),_:1})]),I(u,{data:X.value,"tree-props":{children:"children",hasChildren:"hasChildren"},"row-key":"authorityId",style:{width:"100%"}},{default:w((()=>[I(l,{label:"角色ID","min-width":"180",prop:"authorityId"}),I(l,{align:"left",label:"角色名称","min-width":"180",prop:"authorityName"}),I(l,{align:"left",label:"操作",width:"460"},{default:w((e=>[I(t,{icon:"setting",size:"small",type:"text",onClick:a=>{return t=e.row,R.value=!0,void(T.value=t);var t}},{default:w((()=>[A])),_:2},1032,["onClick"]),I(t,{icon:"plus",size:"small",type:"text",onClick:a=>he(e.row.authorityId)},{default:w((()=>[P])),_:2},1032,["onClick"]),I(t,{icon:"copy-document",size:"small",type:"text",onClick:a=>(e=>{se(),W.value="拷贝角色",F.value="copy";for(const a in J.value)J.value[a]=e[a];H.value=e,$.value=!0})(e.row)},{default:w((()=>[S])),_:2},1032,["onClick"]),I(t,{icon:"edit",size:"small",type:"text",onClick:a=>(e=>{se(),W.value="编辑角色",F.value="edit";for(const a in J.value)J.value[a]=e[a];se(),$.value=!0})(e.row)},{default:w((()=>[U])),_:2},1032,["onClick"]),I(t,{icon:"delete",size:"small",type:"text",onClick:a=>oe(e.row)},{default:w((()=>[q])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"])]),I(n,{modelValue:$.value,"onUpdate:modelValue":a[4]||(a[4]=e=>$.value=e),title:W.value},{footer:w((()=>[b("div",B,[I(t,{size:"small",onClick:de},{default:w((()=>[D])),_:1}),I(t,{size:"small",type:"primary",onClick:ne},{default:w((()=>[E])),_:1})])])),default:w((()=>[I(d,{ref_key:"authorityForm",ref:re,model:J.value,rules:K.value,"label-width":"80px"},{default:w((()=>[I(r,{label:"父级角色",prop:"parentId"},{default:w((()=>[I(o,{modelValue:J.value.parentId,"onUpdate:modelValue":a[1]||(a[1]=e=>J.value.parentId=e),style:{width:"100%"},disabled:"add"==F.value,options:C.value,props:{checkStrictly:!0,label:"authorityName",value:"authorityId",disabled:"disabled",emitPath:!1},"show-all-levels":!1,filterable:""},null,8,["modelValue","disabled","options"])])),_:1}),I(r,{label:"角色ID",prop:"authorityId"},{default:w((()=>[I(i,{modelValue:J.value.authorityId,"onUpdate:modelValue":a[2]||(a[2]=e=>J.value.authorityId=e),disabled:"edit"==F.value,autocomplete:"off"},null,8,["modelValue","disabled"])])),_:1}),I(r,{label:"角色姓名",prop:"authorityName"},{default:w((()=>[I(i,{modelValue:J.value.authorityName,"onUpdate:modelValue":a[3]||(a[3]=e=>J.value.authorityName=e),autocomplete:"off"},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["modelValue","title"]),R.value?(f(),_(N,{key:0,modelValue:R.value,"onUpdate:modelValue":a[5]||(a[5]=e=>R.value=e),"with-header":!1,size:"40%",title:"角色配置"},{default:w((()=>[I(c,{"before-leave":ue,class:"role-box",type:"border-card"},{default:w((()=>[I(s,{label:"角色菜单"},{default:w((()=>[I(y,{ref_key:"menus",ref:ae,row:T.value,onChangeRow:ee},null,8,["row"])])),_:1}),I(s,{label:"角色api"},{default:w((()=>[I(h,{ref_key:"apis",ref:te,row:T.value,onChangeRow:ee},null,8,["row"])])),_:1}),I(s,{label:"资源权限"},{default:w((()=>[I(v,{ref_key:"datas",ref:le,authority:X.value,row:T.value,onChangeRow:ee},null,8,["authority","row"])])),_:1})])),_:1})])),_:1},8,["modelValue"])):k("",!0)])}}});export{F as default};
